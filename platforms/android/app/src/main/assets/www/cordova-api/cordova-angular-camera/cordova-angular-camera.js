(function() {

    var file = angular.module("cordova.camera", []);



    file.provider('camera', [function() {

        var configPath;
        var camera = {};
        if (window.cordova) {
            var camera = {
                destinationType: {
                    DATA_URL: Camera.DestinationType.DATA_URL,
                    FILE_URI: Camera.DestinationType.FILE_URI

                },
                sourceType: {
                    PHOTOLIBRARY: Camera.PictureSourceType.PHOTOLIBRARY
                }
            }
        }

        return {

            config: function(options) {
                configPath = options;
            },

            $get: ['$http', function($http) {

                return {

                    getPicture: function(success, fail) {

                        //get From Camera
                        if (window.cordova) {

                            navigator.camera.getPicture(success, fail, {
                                destinationType: Camera.DestinationType.FILE_URL
                            });
                        }

                    },
                    selectFromGallery: function(success, fail) {

                        //Get From Album
                        if (window.cordova) {
                            navigator.camera.getPicture(success, fail, {
                                quality: 50,
                                sourceType: camera.sourceType.PHOTOLIBRARY,
                                allowEdit: true,
                                destinationType: camera.destinationType.FILE_URI
                            });
                        }
                    },
                    upload: function(mobile, imageData, cb, err) {

                        if (window.cordova) {
                            var ft = new FileTransfer(),
                                options = new FileUploadOptions();

                            options.fileKey = "file";
                            options.fileName = 'filename.jpg'; // We will use the name auto-generated by Node at the server side.
                            options.mimeType = "image/jpeg";
                            options.chunkedMode = false;
                            options.params = { // Whatever you populate options.params with, will be available in req.body at the server-side.
                                "description": "Uploaded from my phone",
                                mobile: mobile
                            };

                            ft.upload(imageData, configPath.saveImages, cb, err, options);
                        } else {
                            log("Running In A Browser:");
                            err({ message: 'Running In A Browser :' });
                        }

                        // $http({
                        //     method: 'GET',
                        //     url: options.saveImages,
                        //     data: { images: imageData, mobile: mobile }
                        // }).then(cb)


                    },


                }


            }]



        }



    }])



})()